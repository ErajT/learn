name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: ðŸ”‘ Install SSH & SSHPASS
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass openssh-client
      - name: ðŸš€ Deployment
        run: |
          sshpass -p "3BvyPCdMqcz9IlHM9tRt" ssh -o StrictHostKeyChecking=no deliberatives@147.93.85.48 << 'EOF'
            # Navigate to the project directory
            cd /home/deliberatives/learn
            
            # âœ… FIX: Reset the repository to match GitHubâ€™s main branch
            git reset --hard origin/main
            git pull --no-rebase https://github.com/ErajT/learn.git main --force

            # âœ… Backend Setup
            cd backend
            npm install

            # âœ… Restart PM2
            PORT=5001 pm2 restart server.js --name server || pm2 start server.js --name server

            cd ..
            # Frontend Setup
            cd learn
            npm install
            npm run build
            cp -r dist/* /home/deliberatives/htdocs/deliberatives.com/
            
          EOF
